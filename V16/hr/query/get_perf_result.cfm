<cfquery name="GET_PERF_RESULT" datasource="#dsn#">
	SELECT 
		EPERF.PER_ID,
		EPERF.START_DATE,
		EPERF.FINISH_DATE,
		EQ.QUIZ_ID,
		EQ.QUIZ_HEAD,
		EQ.POSITION_CAT_ID,
		EQ.POSITION_ID AS POSITION_IDS,
		EPOS.POSITION_ID,
		EPOS.POSITION_NAME,
		EPOS.EMPLOYEE_ID,
		EPOS.EMPLOYEE_NAME,
		EPOS.EMPLOYEE_SURNAME
	FROM 
		EMPLOYEE_PERFORMANCE EPERF,
		EMPLOYEE_POSITIONS EPOS,
		EMPLOYEE_QUIZ EQ
	WHERE
		EPERF.EMP_ID = #session.ep.userid#
		AND
		EPOS.EMPLOYEE_ID > 0 
		AND
		(EQ.IS_EDUCATION = 0 OR EQ.IS_EDUCATION IS NULL)
		AND
		(EQ.IS_APPLICATION = 0 OR EQ.IS_APPLICATION IS NULL)
		AND
		(EQ.IS_TRAINER = 0 OR EQ.IS_TRAINER IS NULL)
		AND
		(EQ.IS_INTERVIEW = 0 OR EQ.IS_INTERVIEW IS NULL)
		AND
		(EQ.IS_TEST_TIME = 0 OR EQ.IS_TEST_TIME IS NULL)
		
		<cfif IsDefined("attributes.POSITION_CAT_ID") AND attributes.POSITION_CAT_ID>
			AND
			EQ.POSITION_CAT_ID LIKE '%,#attributes.POSITION_CAT_ID#,%'
			
			AND
			EPOS.POSITION_CAT_ID = #attributes.POSITION_CAT_ID#
		</cfif>
		<cfif IsDefined("attributes.DEPARTMENT_ID") AND attributes.DEPARTMENT_ID NEQ 'all' AND attributes.DEPARTMENT_ID NEQ 'emp'>
			AND
			EPOS.DEPARTMENT_ID = #attributes.DEPARTMENT_ID#
		</cfif>
		<cfif isDefined("attributes.KEYWORD") AND len(attributes.KEYWORD)>
			AND
			(
			EQ.QUIZ_HEAD LIKE '%#attributes.KEYWORD#%'
			OR
			EPOS.EMPLOYEE_NAME LIKE '%#attributes.KEYWORD#%'
			OR
			EPOS.EMPLOYEE_SURNAME LIKE '%#attributes.KEYWORD#%'
			OR
			EPOS.POSITION_NAME LIKE '%#attributes.KEYWORD#%'
			)
		</cfif>
		
		ORDER BY 
			EPOS.EMPLOYEE_NAME,
			EPOS.EMPLOYEE_SURNAME,
			EQ.QUIZ_HEAD
</cfquery>

