<cfquery name="GET_SALES_PROD_DISCOUNT_DETAIL" datasource="#dsn3#">
(
	SELECT
		C.CONTRACT_HEAD,
		C.COMPANY,
		C.STARTDATE,
		C.FINISHDATE,
		C.CONTRACT_ID,
		CSPD.*,
		CSPD.RECORD_DATE AS RECORDDATE,
		CSPD.RECORD_EMP AS RECORD_EMP
	FROM
		CONTRACT_SALES_PROD_DISCOUNT CSPD,
		CONTRACT C
	WHERE
		CSPD.CONTRACT_ID = C.CONTRACT_ID AND
		C.STATUS = 1 AND
		C.STAGE_ID = -2 AND	
		CSPD.PRODUCT_ID = #attributes.PID#
UNION ALL
	SELECT
		'' AS CONTRACT_HEAD,
		'' AS COMPANY,
		'1900-01-01' AS STARTDATE,
		'1900-01-01' AS FINISHDATE,
		-1 AS CONTRACT_ID,
		CSPD.*,
		CSPD.RECORD_DATE AS RECORDDATE,
		CSPD.RECORD_EMP AS RECORD_EMP
	FROM
		CONTRACT_SALES_PROD_DISCOUNT AS CSPD
	WHERE
		CSPD.PRODUCT_ID = #attributes.PID# AND
		CSPD.CONTRACT_ID IS NULL
)
	ORDER BY
		RECORDDATE DESC
</cfquery>
