<cfif not len(listsort(attributes.inform_employee_ids,"numeric"))>
	<cfset attributes.inform_employee_ids = 0>
</cfif>
<cfif not len(LISTSORT(attributes.inform_partner_ids,"NUMERIC"))>
	<cfset attributes.inform_partner_ids = 0> 
</cfif>
<cfif not len(LISTSORT(attributes.inform_consumer_ids,"NUMERIC"))>
	<cfset attributes.inform_consumer_ids = 0>
</cfif>
<cfif not len(LISTSORT(attributes.inform_group_ids,"NUMERIC"))>
	<cfset attributes.inform_group_ids = 0>
</cfif>
<cfquery name="get_class_inform" datasource="#DSN#">
	SELECT
		'inf_employee' AS TYPE,
		TRAINING_CLASS_INFORM.CLASS_ID,
		TRAINING_CLASS_INFORM.EMP_ID AS INF_ID,
		EMPLOYEE_POSITIONS.EMPLOYEE_NAME AS AD,
		EMPLOYEE_POSITIONS.EMPLOYEE_SURNAME AS SOYAD,
		EMPLOYEE_POSITIONS.EMPLOYEE_ID AS IDS,
		EMPLOYEE_POSITIONS.POSITION_NAME  AS POSITION,
		DEPARTMENT.DEPARTMENT_HEAD AS DEPARTMAN,
		C.NICK_NAME AS NICK_NAME,
		BRANCH.BRANCH_NAME AS BRANCH_NAME
	FROM
		TRAINING_CLASS_INFORM,
		EMPLOYEE_POSITIONS,
		DEPARTMENT,
		BRANCH,
		OUR_COMPANY C
	WHERE
		DEPARTMENT.BRANCH_ID = BRANCH.BRANCH_ID AND 
		C.COMP_ID = BRANCH.COMPANY_ID
		<cfif  isdefined("attributes.ex_class_id") and len(attributes.ex_class_id)>
			AND TRAINING_CLASS_INFORM.EX_CLASS_ID = #attributes.ex_class_id#
		</cfif>
		AND TRAINING_CLASS_INFORM.EMP_ID IN (#LISTSORT(attributes.inform_employee_ids,"NUMERIC")#)
		AND EMPLOYEE_POSITIONS.EMPLOYEE_ID = TRAINING_CLASS_INFORM.EMP_ID
		AND EMPLOYEE_POSITIONS.DEPARTMENT_ID = DEPARTMENT.DEPARTMENT_ID
		AND EMPLOYEE_POSITIONS.IS_MASTER = 1
		AND TRAINING_CLASS_INFORM.EMP_ID IS NOT NULL
		AND BRANCH.BRANCH_ID IN (
									SELECT
										BRANCH_ID
									FROM
										EMPLOYEE_POSITION_BRANCHES
									WHERE
										POSITION_CODE = #SESSION.EP.POSITION_CODE#	
								)
		<cfif isdefined("attributes.class_id") and len(attributes.class_id)>
			AND TRAINING_CLASS_INFORM.CLASS_ID=#attributes.class_id#
		</cfif>
	
	UNION
	
	SELECT 
		'inf_partner' AS TYPE,
		TRAINING_CLASS_INFORM.CLASS_ID,
		TRAINING_CLASS_INFORM.PAR_ID INF_ID,
		COMPANY_PARTNER.COMPANY_PARTNER_NAME AS AD,
		COMPANY_PARTNER.COMPANY_PARTNER_SURNAME AS SOYAD,
		COMPANY_PARTNER.PARTNER_ID AS IDS,
		COMPANY_PARTNER.TITLE AS POSITION,
		' ' AS DEPARTMAN, 	
		COMPANY.NICKNAME AS NICK_NAME,
		' ' AS BRANCH_NAME
	FROM
		TRAINING_CLASS_INFORM,
		COMPANY_PARTNER,
		COMPANY
	WHERE
		TRAINING_CLASS_INFORM.CLASS_ID = #attributes.CLASS_ID# AND 
		TRAINING_CLASS_INFORM.PAR_ID IN (#LISTSORT(attributes.INFORM_PARTNER_IDS,"NUMERIC")#) AND 
		COMPANY_PARTNER.PARTNER_ID = TRAINING_CLASS_INFORM.PAR_ID AND 
		COMPANY_PARTNER.COMPANY_ID = COMPANY.COMPANY_ID
	
	UNION
	
	SELECT
		'inf_consumer' AS TYPE,
		TRAINING_CLASS_INFORM.CLASS_ID,
		TRAINING_CLASS_INFORM.CON_ID AS INF_ID,
		CONSUMER.CONSUMER_NAME AS AD,
		CONSUMER.CONSUMER_SURNAME AS SOYAD,
		CONSUMER.CONSUMER_ID AS IDS,
		CONSUMER.TITLE AS POSITION,
		' ' AS DEPARTMAN,
		CONSUMER.COMPANY AS NICK_NAME,
		' ' AS BRANCH_NAME
	FROM
		TRAINING_CLASS_INFORM,
		CONSUMER
	WHERE
		TRAINING_CLASS_INFORM.CLASS_ID = #attributes.CLASS_ID# AND 
		TRAINING_CLASS_INFORM.CON_ID IN (#LISTSORT(attributes.inform_consumer_ids,"NUMERIC")#) AND 
		CONSUMER.CONSUMER_ID = TRAINING_CLASS_INFORM.CON_ID AND 
		TRAINING_CLASS_INFORM.CON_ID IS NOT NULL
	
	UNION 
	
	SELECT
		'inf_group' AS TYPE,
		TRAINING_CLASS_INFORM.CLASS_ID,
		TRAINING_CLASS_INFORM.GRP_ID INF_ID,
		USERS.GROUP_NAME AS AD,
		' ' AS SOYAD,
		USERS.GROUP_ID AS IDS,
		' ' AS POSITION,
		' ' AS DEPARTMAN,
		' ' AS NICK_NAME,
		' ' AS BRANCH_NAME
	FROM
		TRAINING_CLASS_INFORM,
		USERS
	WHERE
		TRAINING_CLASS_INFORM.CLASS_ID = #attributes.CLASS_ID#
		AND TRAINING_CLASS_INFORM.GRP_ID IN (#LISTSORT(attributes.inform_group_ids,"NUMERIC")#)
		AND USERS.GROUP_ID = TRAINING_CLASS_INFORM.GRP_ID
		AND TRAINING_CLASS_INFORM.GRP_ID IS NOT NULL
	ORDER BY 
		AD,
		SOYAD
</cfquery>
