<cfquery name="GET_TMARKET_CONSUMERS" datasource="#dsn#">
	SELECT
		CONSUMER.CONSUMER_ID
	FROM
		CONSUMER
	<cfif listlen(TMARKET.CONSCAT_IDS)>
		,CONSUMER_CAT
	</cfif>
	<cfif listlen(TMARKET.CONS_SECTOR_CATS)>
		,SETUP_SECTOR_CATS
	</cfif>
	<cfif listlen(TMARKET.CONS_SIZE_CATS)>
		,SETUP_COMPANY_SIZE_CATS
	</cfif>
	WHERE
	1 = 1 AND
 	<cfif TMARKET.cons_want_email eq 1>
         CONSUMER.WANT_EMAIL = 1 AND 
    <cfelseif TMARKET.cons_want_email eq 0>
         CONSUMER.WANT_EMAIL = 0  AND 
    <cfelse>
         (CONSUMER.WANT_EMAIL = 1 OR CONSUMER.WANT_EMAIL = 0) AND
    </cfif>
	<cfif listlen(TMARKET.CONS_SIZE_CATS)>
		CONSUMER.COMPANY_SIZE_CAT_ID = SETUP_COMPANY_SIZE_CATS.COMPANY_SIZE_CAT_ID AND
		CONSUMER.COMPANY_SIZE_CAT_ID IN (#LISTSORT(TMARKET.CONS_SIZE_CATS,"NUMERIC")#) AND
	</cfif>
	<cfif listlen(TMARKET.CONS_SECTOR_CATS)>
		CONSUMER.SECTOR_CAT_ID = SETUP_SECTOR_CATS.SECTOR_CAT_ID AND
		CONSUMER.SECTOR_CAT_ID IN (#LISTSORT(TMARKET.CONS_SECTOR_CATS,"NUMERIC")#) AND
	</cfif>
	<cfif listlen(TMARKET.CONSCAT_IDS)>
		CONSUMER.CONSUMER_CAT_ID = CONSUMER_CAT.CONSCAT_ID AND
		CONSUMER_CAT.CONSCAT_ID IN (#LISTSORT(TMARKET.CONSCAT_IDS,"NUMERIC")#) AND
	</cfif>
	<cfif len(TMARKET.AGE_LOWER)>
		DATEDIFF(YEAR, CONSUMER.BIRTHDATE, #now()#) >= #TMARKET.AGE_LOWER# AND
	</cfif>
	<cfif len(TMARKET.AGE_UPPER)>
		DATEDIFF(YEAR, CONSUMER.BIRTHDATE, #now()#) <= #TMARKET.AGE_UPPER# AND
	</cfif>
	<cfif len(TMARKET.TMARKET_EDUCATION)>
		CONSUMER.EDUCATION LIKE '%#TMARKET.TMARKET_EDUCATION#%' AND
	</cfif>
	<cfif len(TMARKET.CHILD_LOWER)>
		CONSUMER.CHILD >= #TMARKET.CHILD_LOWER# AND
	</cfif>
	<cfif len(TMARKET.CHILD_UPPER)>
		CONSUMER.CHILD <= #TMARKET.CHILD_UPPER# AND
	</cfif>
<!--- 	<cfif len(TMARKET.TMARKET_BIRTH_PLACE)>
		CONSUMER.BIRTHPLACE LIKE '%#TMARKET.TMARKET_BIRTH_PLACE#%' AND
	</cfif> --->
	<cfif len(TMARKET.TMARKET_LOCATION)>
		<cfset COUNTER = 0>
		(
			<cfloop LIST="#TMARKET.TMARKET_LOCATION#" DELIMITERS=" " INDEX="I"><cfset COUNTER = COUNTER+1>
				CONSUMER.HOMEADDRESS LIKE '%#I#%' OR
				CONSUMER.WORKADDRESS LIKE '%#I#%'			
				<!--- CONSUMER.HOMECOUNTY LIKE '%#I#%' OR
				CONSUMER.HOMECITY LIKE '%#I#%' OR
				CONSUMER.WORKCOUNTY LIKE '%#I#%' OR
				CONSUMER.WORKCITY LIKE '%#I#%' OR
				CONSUMER.COUNTRY LIKE '%#I#%' BK kaldirildi 20051101--->
			<cfif listlen(TMARKET.TMARKET_LOCATION," ") neq COUNTER>OR</cfif>
			</cfloop>
		)
		AND
	</cfif>
	<cfif len(TMARKET.TMARKET_MEMBERSHIP_STARTDATE)>
		CONSUMER.RECORD_DATE >= '#TMARKET.TMARKET_MEMBERSHIP_STARTDATE#' AND
	</cfif>
	<cfif len(TMARKET.TMARKET_MEMBERSHIP_FINISHDATE)>
		CONSUMER.RECORD_DATE <= '#TMARKET.TMARKET_MEMBERSHIP_FINISHDATE#' AND
	</cfif>
	<cfif len(ListSort(TMARKET.TARGET_ALTS,'numeric'))>
		<cfloop list="#ListSort(TMARKET.TARGET_ALTS,'numeric')#" index="alt">
			CONSUMER.CONSUMER_ID IN 
				(
					SELECT
						CON_ID
					FROM
						SURVEY_VOTES
					WHERE
						VOTES LIKE '%,#alt#,%'
				)
		<cfif alt neq ListLast(ListSort(TMARKET.TARGET_ALTS,'numeric'))>AND</cfif>
		</cfloop>
		AND
	</cfif>
	<cfif listlen(TMARKET.CONS_IS_POTANTIAL)>
		CONSUMER.ISPOTANTIAL IN (#LISTSORT(TMARKET.CONS_IS_POTANTIAL,"NUMERIC")#) AND
	</cfif>
	<cfif listlen(TMARKET.TMARKET_SEX)>
		CONSUMER.SEX IN (#LISTSORT(TMARKET.TMARKET_SEX,"NUMERIC")#) AND
	</cfif>
	<cfif listlen(TMARKET.TMARKET_MARITAL_STATUS)>
		CONSUMER.MARRIED IN (#LISTSORT(TMARKET.TMARKET_MARITAL_STATUS,"NUMERIC")#) AND
	</cfif>
     <cfif listlen(TMARKET.CONS_STATUS)>CONSUMER.CONSUMER_STATUS IN (#TMARKET.CONS_STATUS#) AND</cfif>
<!--- 	<cfif len(TMARKET.CONSUMER_COMPANY)>
		CONSUMER.COMPANY LIKE '%#TMARKET.CONSUMER_COMPANY#%' AND
	</cfif> --->
	1=1
</cfquery>
